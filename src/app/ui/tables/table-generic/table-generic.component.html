<div class="w-full bg-btw-secondary rounded-lg shadow-lg border border-btw">
  <!-- Header -->
  <div class="bg-primary bg-chill px-6 py-4 rounded-t-lg">
    <h2 class="text-2xl font-bold text-white">{{ tableTitle }}</h2>
  </div>
  <!-- Toolbar -->
  <div
    class="px-6 py-4 border-b border-btw flex flex-col sm:flex-row gap-4 justify-between items-center bg-btw-secondary">
    <div *ngIf="showSearch" class="relative flex-1 max-w-md">
      <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 text-btw w-5 h-5" fill="none"
           stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
      </svg>
      <input
        type="text"
        placeholder="Buscar..."
        [(ngModel)]="searchTerm"
        (ngModelChange)="onSearchChange()"
        class="w-full pl-10 pr-4 py-2 border border-btw rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition bg-transparent"
      />
    </div>
    <div *ngIf="showExport" class="flex gap-2">
      <button
        (click)="exportToCSV()"
        class="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition shadow-md hover:shadow-lg"
      >
        <app-icon-material nameIcon="drive_export" sizeIcon="medium" class="text-white p-0 m-0"></app-icon-material>
        Exportar Datos
      </button>
    </div>
  </div>
  <!-- Info -->
  <div class="px-6 py-2 text-sm text-btw bg-btw-primary">
    <ng-container *ngIf="usePaginationConfig; else defaultInfo">
      Mostrando {{ getStartIndex() + 1 }} - {{ getEndIndex() }} de {{ totalItems }} registros
    </ng-container>
    <ng-template #defaultInfo>
      Mostrando {{ paginatedData.length }} de {{ sortedData.length }} registros
      <span *ngIf="searchTerm"> (filtrado de {{ data.length }} totales)</span>
    </ng-template>
  </div>
  <!-- Table Container with fixed space at bottom -->
  <div class="overflow-x-auto pb-48">
    <table class="w-full">
      <thead class="sticky top-0 z-10">
      <tr class="bg-btw-primary border-b border-btw">
        <th
          *ngFor="let column of columns"
          (click)="column.sortable !== false && handleSort(column.key)"
          [class.cursor-pointer]="column.sortable !== false"
          [class.hover:bg-gray-200]="column.sortable !== false"
          class="px-6 py-4 text-left text-sm font-semibold text-btw select-none transition"
        >
          <div class="flex items-center gap-2">
            {{ column.header }}

            <!-- Icono cuando NO estÃ¡ ordenado (muestra ambas flechas) -->
            <svg
              *ngIf="column.sortable !== false && sortConfig.key !== column.key"
              class="w-4 h-4 text-gray-400 opacity-50"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>
            </svg>

            <!-- Icono ascendente -->
            <svg
              *ngIf="column.sortable !== false && sortConfig.key === column.key && sortConfig.direction === 'asc'"
              class="w-4 h-4 text-blue-600"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
            </svg>

            <!-- Icono descendente -->
            <svg
              *ngIf="column.sortable !== false && sortConfig.key === column.key && sortConfig.direction === 'desc'"
              class="w-4 h-4 text-blue-600"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </div>
        </th>
      </tr>
      </thead>
      <tbody>
      <tr
        *ngFor="let row of displayData; let i = index; let last = last"
        class="border-b border-btw hover:bg-opacity-25 transition"
      >
        <td
          *ngFor="let column of columns"
          class="px-6 py-4 text-sm text-btw"
          [class.static]="!last"
          [class.relative]="last"
        >
          <!-- Si existe template personalizado para esta columna -->
          <ng-container *ngIf="getTemplateForColumn(column.key); else defaultCell">
            <ng-container
              *ngTemplateOutlet="getTemplateForColumn(column.key)!; context: { $implicit: row[column.key], row: row, index: i }"
            ></ng-container>
          </ng-container>
          <!-- Template por defecto -->
          <ng-template #defaultCell>
            {{ row[column.key] }}
          </ng-template>
        </td>
      </tr>
      <tr *ngIf="displayData.length === 0">
        <td [attr.colspan]="columns.length" class="px-6 py-12 text-center text-gray-500">
          No se encontraron resultados
        </td>
      </tr>
      </tbody>
    </table>
  </div>
  <!-- Pagination -->
  <div
    *ngIf="showPagination && calculatedTotalPages > 1"
    class="px-6 py-4 border-t border-btw flex flex-col sm:flex-row gap-4 justify-between items-center bg-btw-primary rounded-b-lg"
  >
    <button
      (click)="onPreviousPage()"
      [disabled]="currentPageNumber === 1"
      class="bg-primary text-white flex items-center gap-2 px-4 py-2 rounded-lg borderdisabled:bg-gray-100
       border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100 transition"
    >
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
      </svg>
      Anterior
    </button>
    <div class="flex gap-2 flex-wrap justify-center">
      <button
        *ngFor="let page of getVisiblePages()"
        (click)="page !== '...' && onGoToPage(+page)"
        [disabled]="page === '...'"
        [class.bg-primary]="currentPageNumber === page"
        [class.text-white]="currentPageNumber === page"
        [class.shadow-md]="currentPageNumber === page"
        [class.border]="currentPageNumber !== page && page !== '...'"
        [class.border-gray-300]="currentPageNumber !== page && page !== '...'"
        [class.hover:bg-gray-100]="currentPageNumber !== page && page !== '...'"
        [class.cursor-default]="page === '...'"
        class="px-4 py-2 rounded-lg transition min-w-[40px]"
      >
        {{ page }}
      </button>
    </div>
    <button
      (click)="onNextPage()"
      [disabled]="currentPageNumber === calculatedTotalPages"
      class="bg-primary text-white flex items-center gap-2 px-4 py-2 rounded-lg border disabled:bg-gray-100
      border-btw disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100 transition"
    >
      Siguiente
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
      </svg>
    </button>
  </div>
</div>
